# AWS Configuration Profile
# Use this profile when deploying to AWS
# Activate with: --spring.profiles.active=aws

spring:
  r2dbc:
    url: r2dbc:postgresql://${DB_HOST}:${DB_PORT:5432}/${DB_NAME:rapidphoto}?sslMode=require
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    pool:
      initial-size: 10
      max-size: 30
      max-idle-time: 30m
      validation-query: SELECT 1

  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT:6379}
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT:5432}/${DB_NAME:rapidphoto}?sslmode=require
    user: ${DB_USERNAME}
    password: ${DB_PASSWORD}

# AWS S3 Configuration
cloud:
  aws:
    region:
      static: ${AWS_REGION:us-east-1}
    credentials:
      # Use IAM role when running on EC2 (recommended)
      # Or set access-key and secret-key for local testing
      instance-profile: true
    s3:
      bucket: ${S3_BUCKET}
      thumbnail-bucket: ${S3_THUMBNAIL_BUCKET}
      endpoint: # Leave empty for real AWS S3 (only used for LocalStack)

# Application Configuration
app:
  upload:
    max-file-size: 100MB
    max-photos-per-upload: 500
    max-concurrent-uploads: 10
    allowed-mime-types:
      - image/jpeg
      - image/jpg
      - image/png
      - image/heic
      - image/heif
      - image/webp

  cors:
    allowed-origins:
      - ${FRONTEND_URL}
      - http://localhost:8081
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH
      - OPTIONS
    allowed-headers:
      - "*"
    allow-credentials: true
    max-age: 3600

# JWT Configuration
jwt:
  secret: ${JWT_SECRET}
  expiration: 86400000 # 24 hours
  refresh-expiration: 604800000 # 7 days

# Logging for production
logging:
  level:
    root: INFO
    com.rapidphoto: INFO
    org.springframework.web: INFO
    org.springframework.r2dbc: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Server Configuration
server:
  port: 8080
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

# Management / Actuator (for ALB health checks)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  health:
    defaults:
      enabled: true
